<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>RealistikPanel - {{ title }}</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Poppins', 'sans-serif'],
              display: ['Comfortaa', 'cursive'],
            },
            colors: {
              border: "#334155", // Slate-700
              input: "#334155",
              ring: "#3B82F6",
              background: "#0F172A", // Slate-900
              foreground: "#FFFFFF",
              primary: {
                DEFAULT: "#3B82F6", // Blue-500
                foreground: "#FFFFFF",
              },
              secondary: {
                DEFAULT: "#1E293B", // Slate-800
                foreground: "#FFFFFF",
              },
              destructive: {
                DEFAULT: "#EF4444",
                foreground: "#FFFFFF",
              },
              muted: {
                DEFAULT: "#1E293B",
                foreground: "#9CA3AF", // Gray-400
              },
              accent: {
                DEFAULT: "#2563EB", // Blue-600
                foreground: "#FFFFFF",
              },
              popover: {
                DEFAULT: "#1E293B",
                foreground: "#FFFFFF",
              },
              card: {
                DEFAULT: "#1E293B",
                foreground: "#FFFFFF",
              },
            },
            borderRadius: {
              lg: "0.75rem",
              md: "0.5rem",
              sm: "0.25rem",
            },
            backgroundImage: {
                'primary-gradient': 'linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)',
                'page-gradient': 'radial-gradient(circle at top right, #1E293B, #0F172A)',
            }
          },
        },
      }
    </script>
    <style>
      body {
        background-color: #0F172A;
        color: #FFFFFF;
      }
      
      .glass-effect {
          background: rgba(30, 41, 59, 0.7);
          backdrop-filter: blur(12px);
          border-bottom: 1px solid rgba(51, 65, 85, 0.5);
      }

      /* Loader Styles */
      .loader-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: #0F172A;
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 9999;
          transition: opacity 0.5s ease-out, visibility 0.5s;
          opacity: 1;
          visibility: visible;
      }
      
      .loader-hidden {
          opacity: 0;
          visibility: hidden;
      }

      .spinner {
          width: 50px;
          height: 50px;
          border: 3px solid rgba(59, 130, 246, 0.2);
          border-radius: 50%;
          border-top-color: #3B82F6;
          animation: spin 1s linear infinite;
      }

      @keyframes spin {
          to { transform: rotate(360deg); }
      }

      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #0F172A;
      }
      ::-webkit-scrollbar-thumb {
        background: #334155;
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #3B82F6;
      }
    </style>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Toastr -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet"/>
    {% block head %}{% endblock %}
  </head>
  <body class="antialiased h-screen flex overflow-hidden font-sans" x-data="{ 
      sidebarOpen: false, 
      sidebarCollapsed: localStorage.getItem('sidebarCollapsed') === 'true',
      toggleSidebar() {
          this.sidebarCollapsed = !this.sidebarCollapsed;
          localStorage.setItem('sidebarCollapsed', this.sidebarCollapsed);
      }
  }">
    
    <!-- Page Loader -->
    <div class="loader-overlay" id="page-loader">
        <div class="spinner"></div>
    </div>

    <!-- Page Background Gradient -->
    <div class="fixed inset-0 z-[-1] bg-page-gradient pointer-events-none"></div>

    <!-- Mobile Sidebar Backdrop -->
    <div 
        x-show="sidebarOpen" 
        @click="sidebarOpen = false"
        x-transition:enter="transition-opacity ease-linear duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition-opacity ease-linear duration-300"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-40 lg:hidden"
    ></div>

    <!-- Sidebar -->
    <aside 
        class="fixed inset-y-0 left-0 z-50 w-64 glass-effect transition-all duration-300 ease-in-out border-r border-slate-700/50 flex flex-col shadow-2xl shrink-0 lg:static"
        :class="[
            sidebarCollapsed ? 'lg:w-20' : 'lg:w-64',
            sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'
        ]"
    >
        <div class="flex h-16 items-center px-6 justify-between shrink-0 overflow-hidden">
            <a href="/" class="flex items-center gap-3 font-display font-bold text-xl tracking-tight whitespace-nowrap">
                <div class="h-9 w-9 rounded-xl flex items-center justify-center bg-slate-800 border border-slate-700/50 shadow-md shrink-0 p-1.5 overflow-hidden">
                    <img src="/static/img/logo.ico" alt="Logo" class="w-full h-full object-contain">
                </div>
                <span class="text-white transition-opacity duration-300" :class="sidebarCollapsed ? 'lg:opacity-0 lg:w-0' : 'opacity-100'">{{ config.srv_name }}</span>
            </a>
        </div>

        <div class="flex-1 overflow-y-auto overflow-x-hidden py-6 custom-scrollbar">
            <nav class="space-y-1 px-3">
                
                <div class="px-4 py-2 text-[10px] font-bold uppercase text-slate-500 tracking-[0.2em] mb-2 transition-opacity duration-300 whitespace-nowrap" :class="sidebarCollapsed ? 'lg:opacity-0 lg:hidden' : 'opacity-100'">General</div>
                
                <a href="/dash" class="AccessRAP group flex items-center rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200 hover:bg-blue-500/10 {% if route == '/dash' %}bg-primary text-white shadow-lg shadow-blue-500/20{% else %}text-slate-400 hover:text-white{% endif %}" :title="sidebarCollapsed ? 'Dashboard' : ''">
                    <i class="fas fa-gauge-high w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">Dashboard</span>
                </a>
                <a href="/users/1" class="ManageUsers group flex items-center rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200 hover:bg-blue-500/10 {% if route == '/users' %}bg-primary text-white shadow-lg shadow-blue-500/20{% else %}text-slate-400 hover:text-white{% endif %}" :title="sidebarCollapsed ? 'Users' : ''">
                    <i class="fas fa-users w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">Users</span>
                </a>
                <a href="/stats" class="AccessRAP group flex items-center rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200 hover:bg-blue-500/10 {% if route == '/stats' %}bg-primary text-white shadow-lg shadow-blue-500/20{% else %}text-slate-400 hover:text-white{% endif %}" :title="sidebarCollapsed ? 'Statistics' : ''">
                    <i class="fas fa-chart-line w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">Statistics</span>
                </a>
                
                <div class="px-4 py-2 text-[10px] font-bold uppercase text-slate-500 tracking-[0.2em] mb-2 mt-6 transition-opacity duration-300 whitespace-nowrap" :class="sidebarCollapsed ? 'lg:opacity-0 lg:hidden' : 'opacity-100'">System</div>

                <a href="/logs/1" class="ViewRAPLogs group flex items-center rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200 hover:bg-blue-500/10 {% if route == '/logs' %}bg-primary text-white shadow-lg shadow-blue-500/20{% else %}text-slate-400 hover:text-white{% endif %}" :title="sidebarCollapsed ? 'Action Logs' : ''">
                    <i class="fas fa-list-check w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">Action Logs</span>
                </a>
                <a href="/ban-logs/1" class="ViewRAPLogs group flex items-center rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200 hover:bg-blue-500/10 {% if route == '/ban-logs' %}bg-primary text-white shadow-lg shadow-blue-500/20{% else %}text-slate-400 hover:text-white{% endif %}" :title="sidebarCollapsed ? 'Ban Logs' : ''">
                    <i class="fas fa-user-xmark w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">Ban Logs</span>
                </a>
                <a href="/console/1" class="RPErrorLogs group flex items-center rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200 hover:bg-blue-500/10 {% if route == '/console' %}bg-primary text-white shadow-lg shadow-blue-500/20{% else %}text-slate-400 hover:text-white{% endif %}" :title="sidebarCollapsed ? 'Console' : ''">
                    <i class="fas fa-terminal w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">Console</span>
                </a>

                <div class="px-4 py-2 text-[10px] font-bold uppercase text-slate-500 tracking-[0.2em] mb-2 mt-6 transition-opacity duration-300 whitespace-nowrap" :class="sidebarCollapsed ? 'lg:opacity-0 lg:hidden' : 'opacity-100'">Management</div>
                
                <a href="/rank" class="ManageBeatmaps group flex items-center rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200 hover:bg-blue-500/10 {% if route == '/rank' %}bg-primary text-white shadow-lg shadow-blue-500/20{% else %}text-slate-400 hover:text-white{% endif %}" :title="sidebarCollapsed ? 'Ranking' : ''">
                    <i class="fas fa-award w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">Ranking</span>
                </a>
                <a href="/rankreq/1" class="ManageBeatmaps group flex items-center rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200 hover:bg-blue-500/10 {% if route == '/rankreq' %}bg-primary text-white shadow-lg shadow-blue-500/20{% else %}text-slate-400 hover:text-white{% endif %}" :title="sidebarCollapsed ? 'Requests' : ''">
                    <i class="fas fa-paper-plane w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">Requests</span>
                </a>
                <a href="/bancho/settings" class="ManageSettings group flex items-center rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200 hover:bg-blue-500/10 {% if route == '/bancho/settings' %}bg-primary text-white shadow-lg shadow-blue-500/20{% else %}text-slate-400 hover:text-white{% endif %}" :title="sidebarCollapsed ? 'Bancho' : ''">
                    <i class="fas fa-server w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">Bancho Settings</span>
                </a>
                <a href="/system/settings" class="ManageSettings group flex items-center rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200 hover:bg-blue-500/10 {% if route == '/system/settings' %}bg-primary text-white shadow-lg shadow-blue-500/20{% else %}text-slate-400 hover:text-white{% endif %}" :title="sidebarCollapsed ? 'Settings' : ''">
                    <i class="fas fa-sliders w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">System Settings</span>
                </a>
                <a href="/badges" class="ManageBadges group flex items-center rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200 hover:bg-blue-500/10 {% if route == '/badges' %}bg-primary text-white shadow-lg shadow-blue-500/20{% else %}text-slate-400 hover:text-white{% endif %}" :title="sidebarCollapsed ? 'Badges' : ''">
                    <i class="fas fa-certificate w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">Badges</span>
                </a>
                <a href="/privileges" class="ManagePrivileges group flex items-center rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200 hover:bg-blue-500/10 {% if route == '/privileges' %}bg-primary text-white shadow-lg shadow-blue-500/20{% else %}text-slate-400 hover:text-white{% endif %}" :title="sidebarCollapsed ? 'Privileges' : ''">
                    <i class="fas fa-key w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">Privileges</span>
                </a>
                <a href="/clans/1" class="ManageClans group flex items-center rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200 hover:bg-blue-500/10 {% if route == '/clans' %}bg-primary text-white shadow-lg shadow-blue-500/20{% else %}text-slate-400 hover:text-white{% endif %}" :title="sidebarCollapsed ? 'Clans' : ''">
                    <i class="fas fa-people-group w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">Clans</span>
                </a>

                <div class="px-4 py-2 text-[10px] font-bold uppercase text-slate-500 tracking-[0.2em] mb-2 mt-6 transition-opacity duration-300 whitespace-nowrap" :class="sidebarCollapsed ? 'lg:opacity-0 lg:hidden' : 'opacity-100'">RealistikPanel</div>
                
                <a href="{{ config.app_repo_url }}" target="_blank" class="group flex items-center rounded-xl px-4 py-3 text-sm font-medium text-slate-400 hover:bg-blue-500/10 hover:text-white" :title="sidebarCollapsed ? 'Source Code' : ''">
                    <i class="fab fa-github-alt w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">Source Code</span>
                </a>
                <a href="/logout" class="group flex items-center rounded-xl px-4 py-3 text-sm font-medium text-red-400 hover:bg-red-500/10 hover:text-red-300" :title="sidebarCollapsed ? 'Logout' : ''">
                    <i class="fas fa-sign-out-alt w-5 text-center mr-3 shrink-0"></i> 
                    <span :class="sidebarCollapsed ? 'lg:hidden' : ''">Logout</span>
                </a>
            </nav>
        </div>
        
        <!-- Collapse Button -->
        <div class="p-4 border-t border-slate-700/50 hidden lg:flex justify-end shrink-0">
            <button 
                @click="toggleSidebar()" 
                class="text-slate-500 hover:text-white transition-colors p-2 rounded-xl hover:bg-slate-800"
            >
                <i class="fas" :class="sidebarCollapsed ? 'fa-chevron-right' : 'fa-chevron-left'"></i>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="flex flex-1 flex-col overflow-hidden">
        
        <!-- Navbar -->
        <header class="flex h-16 items-center gap-4 glass-effect px-8 z-10 shrink-0">
            <button @click="sidebarOpen = true" class="lg:hidden text-slate-400 hover:text-white">
                <i class="fas fa-bars-staggered text-xl"></i>
            </button>
            
            <div class="flex flex-col">
                <h1 class="font-display font-bold text-xl tracking-tight text-white">{{ title }}</h1>
            </div>
            
            <div class="ml-auto flex items-center gap-6">
                <div x-data="{ open: false }" class="relative">
                    <button @click="open = !open" @click.outside="open = false" class="flex items-center gap-3 outline-none group bg-slate-800/50 hover:bg-slate-800 p-1.5 pr-4 rounded-2xl border border-slate-700/50 transition-all">
                         <img src="{{ config.api_avatar_url }}{{ session.user_id }}" alt="Avatar" class="h-8 w-8 rounded-xl object-cover">
                         <div class="text-left hidden md:block leading-none">
                             <div class="text-sm font-semibold text-white group-hover:text-primary transition-colors">{{ session.username }}</div>
                             <div class="text-[10px] text-slate-500 font-bold uppercase tracking-wider mt-1">{{ session.privilege_name }}</div>
                         </div>
                         <i class="fas fa-angle-down text-xs text-slate-500 ml-2"></i>
                    </button>
                    
                    <div 
                        x-show="open" 
                        x-transition:enter="transition ease-out duration-150"
                        x-transition:enter-start="opacity-0 scale-95 translate-y-2"
                        x-transition:enter-end="opacity-100 scale-100 translate-y-0"
                        x-transition:leave="transition ease-in duration-100"
                        x-transition:leave-start="opacity-100 scale-100 translate-y-0"
                        x-transition:leave-end="opacity-0 scale-95 translate-y-2"
                        class="absolute right-0 top-full mt-3 w-60 rounded-2xl border border-slate-700 bg-slate-800 text-white shadow-2xl shadow-black/50 outline-none z-50 overflow-hidden"
                        style="display: none;"
                    >
                        <div class="p-2">
                            <div class="px-3 py-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest">Account</div>
                            <a href="{{ config.srv_url }}u/{{ session.user_id }}" class="flex cursor-pointer select-none items-center rounded-xl px-3 py-2.5 text-sm outline-none transition-colors hover:bg-slate-700">
                                <i class="fas fa-circle-user mr-3 text-slate-400"></i> Profile
                            </a>
                            <div class="h-px bg-slate-700 my-1"></div>
                            <a href="/logout" class="flex cursor-pointer select-none items-center rounded-xl px-3 py-2.5 text-sm outline-none transition-colors hover:bg-red-500/10 text-red-400">
                                <i class="fas fa-arrow-right-from-bracket mr-3"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Page Content -->
        <main class="flex-1 overflow-y-auto p-8 relative custom-scrollbar">
            {% if data and data["Alert"] %}
                <div class="mb-8 rounded-2xl border border-blue-500/20 bg-blue-500/5 p-5 text-blue-100 backdrop-blur-md flex items-center gap-4">
                    <div class="h-10 w-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400 shrink-0">
                        <i class="fas fa-circle-info"></i>
                    </div>
                    <div class="text-sm font-medium leading-relaxed">{{ data["Alert"]|safe }}</div>
                </div>
            {% endif %}

            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    
    <script>
      // Hide loader when page is loaded
      window.addEventListener('load', function() {
          const loader = document.getElementById('page-loader');
          if (loader) loader.classList.add('loader-hidden');
      });

      // Handle back/forward cache (bfcache)
      window.addEventListener('pageshow', function(event) {
          const loader = document.getElementById('page-loader');
          if (loader) loader.classList.add('loader-hidden');
      });

      // Show loader on internal navigation links
      document.querySelectorAll('a[href^="/"]').forEach(link => {
          link.addEventListener('click', function(e) {
              if (link.target !== '_blank' && !e.ctrlKey && !e.metaKey) {
                  if (link.href.split('#')[0] !== window.location.href.split('#')[0]) {
                      const loader = document.getElementById('page-loader');
                      if (loader) loader.classList.remove('loader-hidden');
                  }
              }
          });
      });

      toastr.options = {
        "closeButton": true,
        "progressBar": true,
        "positionClass": "toast-top-right",
        "showDuration": "300",
        "hideDuration": "1000",
        "timeOut": "5000",
        "extendedTimeOut": "1000",
      }

      // Redesign Toastr
      const style = document.createElement('style');
      style.innerHTML = `
        #toast-container > div {
          background-color: #1E293B !important;
          border: 1px solid #334155 !important;
          border-radius: 1rem !important;
          box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.5) !important;
          opacity: 1 !important;
          color: white !important;
          padding: 1rem 1.25rem 1rem 3.5rem !important;
        }
        #toast-container > .toast-success { border-left: 4px solid #10B981 !important; }
        #toast-container > .toast-error { border-left: 4px solid #EF4444 !important; }
        #toast-container > .toast-info { border-left: 4px solid #3B82F6 !important; }
        .toast-progress { background-color: #3B82F6 !important; }
      `;
      document.head.appendChild(style);

      {% if info %} toastr.info("{{ info | safe }}") {% endif %}
      {% if success %} toastr.success("{{ success | safe }}") {% endif %}
      {% if error %} toastr.error("{{ error | safe }}") {% endif %}

      var UserPriv = "{{ session.privileges.value }}";
      var AccessRAP = 2 << 2;
      var ManageUsers = 2 << 3;
      var ManageBeatmaps = 2 << 7;
      var ManageServers = 2 << 8;
      var ManageSettings = 2 << 9;
      var ManageBadges = 2 << 13;
      var ViewRAPLogs = 2 << 14;
      var ManagePrivileges = 2 << 15;
      var RPErrorLogs = 2 << 26;
      var RPManageClans = 2 << 27;

      function checkPerms(perm, className) {
          if (!(UserPriv & perm)) {
              document.querySelectorAll('.' + className).forEach(e => e.remove());
          }
      }

      checkPerms(AccessRAP, 'AccessRAP');
      checkPerms(ManageUsers, 'ManageUsers');
      checkPerms(ManageBeatmaps, 'ManageBeatmaps');
      checkPerms(ManageServers, 'ManageServers');
      checkPerms(ManageSettings, 'ManageSettings');
      checkPerms(ManageBadges, 'ManageBadges');
      checkPerms(ViewRAPLogs, 'ViewRAPLogs');
      checkPerms(ManagePrivileges, 'ManagePrivileges');
      checkPerms(RPErrorLogs, 'RPErrorLogs');
      checkPerms(RPManageClans, 'ManageClans');
    </script>
  </body>
</html>